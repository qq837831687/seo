#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Agent 4-7: Content Architect, Chief Reviewer, Virality Forecaster, Headline King
å¿«é€Ÿå®ç°ç‰ˆæœ¬ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰

Version: 1.0
Created: 2026-01-20
"""

import json
from typing import Dict, Optional
from datetime import datetime


# ============================================================================
# Agent 4: Content Architect - å†…å®¹å†™ä½œ
# ============================================================================

class Agent4ContentArchitect:
    """Agent 4: å†…å®¹å†™ä½œå¸ˆ"""

    def __init__(self, llm_caller=None):
        self.agent_id = "Agent_4_ContentArchitect"
        self.agent_name = "å†…å®¹å†™ä½œå¸ˆ"
        self.llm_caller = llm_caller

    def write_article(
        self,
        topic: str,
        outline: Dict,
        viral_analysis: Dict,
        custom_requirements: Optional[Dict] = None,
        revision_suggestions: Optional[Dict] = None,
        optimization_suggestions: Optional[Dict] = None,
        mode: str = "standard"
    ) -> Dict:
        """
        æ’°å†™æ–‡ç« å†…å®¹

        Args:
            topic: è¯é¢˜
            outline: Agent 3 çš„å¤§çº²
            viral_analysis: Agent 2 çš„çˆ†æ¬¾åˆ†æ
            custom_requirements: è‡ªå®šä¹‰è¦æ±‚
            revision_suggestions: ä¿®æ”¹å»ºè®®
            optimization_suggestions: ä¼˜åŒ–å»ºè®®
            mode: æ¨¡å¼

        Returns:
            æ–‡ç« è‰ç¨¿
        """
        if self.llm_caller is None:
            return self._get_mock_draft(topic, outline, viral_analysis)

        return self._get_mock_draft(topic, outline, viral_analysis)

    def _get_mock_draft(self, topic: str, outline: Dict, viral_analysis: Dict) -> Dict:
        """è·å–æ¨¡æ‹Ÿçš„è‰ç¨¿"""
        # åŸºäºæˆ‘ä»¬ä¹‹å‰å†™çš„æ–‡ç« 
        return {
            "title": topic,
            "content": """**å¤§å¯’äº†ï¼Œç»™çˆ¸å¦ˆç‚–è¿™ç¢—æ±¤ï¼Œæ¯”ä¹°è¡¥å“å¼ºç™¾å€ï¼ˆé™„3ä¸ªé£Ÿè°±ï¼‰**

**(å¼€åœºï¼šå­å¥³è§†è§’)**

æ˜¨å¤©ï¼Œæœ‹å‹åœˆçœ‹åˆ°ä¸€ä¸ªæœ‹å‹å‘åŠ¨æ€ï¼š

"ç»™çˆ¸å¦ˆä¹°äº†2000å—çš„è¡¥å“ï¼Œç»“æœæˆ‘å¦ˆè¯´'åƒä¸å®Œï¼Œåˆ«ä¹°äº†'ã€‚æˆ‘æ‰çŸ¥é“ï¼Œä»–ä»¬è¦çš„ä¸æ˜¯è´µçš„ï¼Œè€Œæ˜¯æˆ‘æ‡‚ä»–ä»¬çš„èº«ä½“ã€‚"

è¿™æ¡åŠ¨æ€ï¼Œæˆ‘çœ‹äº†å¥½å‡ éã€‚

æ˜¯å•Šï¼Œæˆ‘ä»¬æ€»æƒ³ç»™çˆ¸å¦ˆæœ€å¥½çš„ï¼Œä½†æœ‰æ—¶å€™ï¼Œ**æœ€å¥½çš„ä¸æ˜¯æœ€è´µçš„ï¼Œè€Œæ˜¯æœ€åˆé€‚çš„ã€‚**

å¤§å¯’äº†ï¼Œå¤©æ°”æœ€å†·ï¼Œä¹Ÿæ˜¯å¿ƒè¡€ç®¡ã€å‘¼å¸ç³»ç»Ÿé—®é¢˜é«˜å‘æœŸã€‚

ä¸å…¶ä¹°ä¸€å †è¡¥å“æ”¾é‚£è¿‡æœŸï¼Œä¸å¦‚ç»™çˆ¸å¦ˆç‚–å¯¹æ±¤ã€åšå¯¹èœã€‚

ä»Šå¤©ï¼Œè€æï¼ˆæˆ‘æ˜¯ä¸ªæœ‰8å¹´æŠ¤å·¥ç»éªŒçš„é€€ä¼‘å·¥äººï¼‰æ•™å¤§å®¶ï¼Œ**å¤§å¯’æ€ä¹ˆç»™çˆ¸å¦ˆåƒï¼Œæ‰æ˜¯çœŸçš„å­é¡ºã€‚**

---

### å¤§å¯’é¥®é£Ÿï¼Œæœ‰ä¸ª"ä¸‰å­—ç»"

æˆ‘é‚£ä¼šå„¿åœ¨å·¥å‚å½“æŠ¤å·¥ï¼Œç…§é¡¾è¿‡å¾ˆå¤šè€äººã€‚

æœ‰çš„è€äººå­å¥³å¤©å¤©é€è¡¥å“ï¼Œä½†è€äººè¿˜æ˜¯è¿›åŒ»é™¢ã€‚
æœ‰çš„è€äººåƒå¾—ç®€å•ï¼Œä½†èº«ä½“ç¡¬æœ—ï¼Œç²¾ç¥å¤´ç‰¹å¥½ã€‚

**åŒºåˆ«åœ¨å“ªï¼Ÿ**

æˆ‘çœ‹å¤šäº†ï¼Œå°±æ€»ç»“å‡ºä¸ª"ä¸‰å­—ç»"ï¼š**æ¸©ã€é€šã€æ—¶ã€‚**

#### ç¬¬ä¸€å­—ï¼šæ¸©ï¼ˆä¸æ˜¯çƒ­ï¼‰

**å¤§å¯’è¦æ¸©è¡¥ï¼Œä½†ä¸èƒ½çƒ­è¡¥ã€‚**

**ä»€ä¹ˆæ˜¯æ¸©ï¼Ÿ**
- é¸¡æ±¤ã€é±¼æ±¤ï¼ˆæ¸©è€Œä¸ç‡¥ï¼‰
- å±±è¯ã€è²å­ï¼ˆå¹³å’Œå…»è„¾ï¼‰
- çº¢æ£ã€æ¸æï¼ˆæ¸©è¡¥æ°”è¡€ï¼‰

**ä»€ä¹ˆæ˜¯çƒ­ï¼Ÿï¼ˆè¦å°‘åƒï¼‰**
- ç¾Šè‚‰ã€ç‹—è‚‰ï¼ˆå¤§çƒ­ï¼‰
- è¾£æ¤’ã€èŠ±æ¤’ï¼ˆå¤§ç‡¥ï¼‰
- äººå‚ã€é¹¿èŒ¸ï¼ˆå¤§è¡¥ï¼‰

**ä¸ºä»€ä¹ˆï¼Ÿ**

å¤§å¯’æ˜¯å†¬å¤©çš„å°¾å·´ï¼Œä¹Ÿæ˜¯æ˜¥å¤©çš„å‰å¥ã€‚
è¿™ä¸ªæ—¶å€™åƒå¤ªçƒ­çš„ï¼Œå°±åƒç»™å¿«çƒ§å¼€çš„æ°´è¿˜åŠ å¤§ç«â€”â€”å®¹æ˜“æº¢å‡ºæ¥ï¼ˆä¸Šç«ã€è¡€å‹é«˜ï¼‰ã€‚

**ç»™çˆ¸å¦ˆåƒä»€ä¹ˆï¼Ÿ**

**æ¨èï¼šå±±è¯è²å­é¸¡æ±¤**
- ææ–™ï¼šé¸¡è‚‰500g + å±±è¯1æ®µ + è²å­30é¢— + çº¢æ£5é¢—
- åšæ³•ï¼šç‚–2å°æ—¶ï¼Œå°‘è®¸ç›
- åŠŸæ•ˆï¼šæ¸©è¡¥è„¾èƒƒï¼Œä¸ä¸Šç«
- é€‚åˆï¼šæ‰€æœ‰è€äººï¼ˆåŒ…æ‹¬ç³–å°¿ç—…ã€é«˜è¡€å‹ï¼‰

**æˆ‘ç…§é¡¾è¿‡çš„æå¥¶å¥¶ï¼Œ84å²ï¼Œå¤©å¤©å–è¿™ä¸ªï¼Œå†¬å¤©ä¸€æ¬¡åŒ»é™¢æ²¡å»ã€‚**

---

#### ç¬¬äºŒå­—ï¼šé€šï¼ˆè¡¥å¾—è¿›å»ï¼‰

**å¾ˆå¤šäººé—®æˆ‘ï¼š"æå”ï¼Œæˆ‘å¦ˆå¤©å¤©åƒè¡¥å“ï¼Œæ€ä¹ˆæ²¡ç²¾ç¥ï¼Ÿ"**

æˆ‘é—®ï¼š"å¤§ä¾¿é€šç•…å—ï¼Ÿ"

"æœ‰ç‚¹ä¾¿ç§˜..."

**è¿™å°±å¯¹äº†ï¼è·¯ä¸é€šï¼Œè½¦æ€ä¹ˆå¼€å¾—è¿›å»ï¼Ÿ**

è€äººçš„è„¾èƒƒï¼Œå°±åƒè€æœºå™¨ï¼Œè½¬å¾—æ…¢ã€‚
è¿™æ—¶å€™åƒä¸€å †è¡¥å“ï¼Œè„¾èƒƒè¿åŒ–ä¸äº†ï¼Œåè€Œå˜æˆè´Ÿæ‹…ã€‚

**æ€ä¹ˆ"é€š"ï¼Ÿ**

**æ–¹æ³•1ï¼šæ¯å¤©åƒç‚¹"ç™½é£Ÿ"**
- ç™½èåœï¼ˆé¡ºæ°”ã€æ¶ˆé£Ÿï¼‰
- ç™½èœï¼ˆé€šä¾¿ã€æ¸…çƒ­ï¼‰
- ç™½æ‰è±†ï¼ˆå¥è„¾ç¥›æ¹¿ï¼‰

**ç™½èåœæ˜¯å®**ï¼š
- ç‚–è‚‰æ”¾èåœï¼ˆè§£è…»ã€åŠ©æ¶ˆåŒ–ï¼‰
- ç…®èåœæ°´å–ï¼ˆæ¸…çƒ­ã€åŒ–ç—°ï¼‰
- èåœç¼¨å­ä¹Ÿåˆ«æ‰”ï¼Œå‡‰æ‹Œç€åƒï¼ˆæ¸…çƒ­è§£æ¯’ï¼‰

**ç§€èŠ³çš„å¦™æ‹›**ï¼š
å¥¹æ€»è¯´ï¼š"èåœæ±¤ï¼Œå–ä¸‰å¤©ï¼Œè‚šå­èˆ’æœï¼Œè„¸éƒ½æ¸…çˆ½ã€‚"

---

#### ç¬¬ä¸‰å­—ï¼šæ—¶ï¼ˆé¡ºå¤©æ—¶ï¼‰

**å¤§å¯’åƒä»€ä¹ˆï¼Ÿè¦çœ‹"æ—¶"ã€‚**

**å¤§å¯’å‰7å¤©ï¼ˆç°åœ¨ï¼‰**ï¼š
- å¯ä»¥åƒç‚¹ç¾Šè‚‰ï¼ˆæ¸©é˜³ï¼‰
- ä½†è¦é…èåœï¼ˆæ¸…çƒ­ï¼‰
- ä¸€å‘¨1-2æ¬¡å°±å¤Ÿäº†

**å¤§å¯’å7å¤©**ï¼š
- ç«‹æ˜¥å¿«åˆ°äº†ï¼Œè‚æ°”å¼€å§‹åŠ¨
- è¦å…»è‚ã€æ¸…ç«
- å¤šåƒç»¿è‰²è”¬èœï¼ˆè èœã€èŠ¹èœï¼‰
- å°‘åƒå¤§çƒ­çš„

**ç«‹æ˜¥å‰3å¤©**ï¼š
- å¼€å§‹æ¸…æ·¡é¥®é£Ÿ
- ä¸ºæ˜¥å¤©åšå‡†å¤‡
- å–æ¸…è‚èŒ¶ï¼ˆèŠèŠ±+æ¸æï¼‰

**è€ä¸­åŒ»è¯´ï¼š"é¡ºå¤©æ—¶è€Œé£Ÿï¼Œèƒœè¿‡åƒè¯ã€‚"**

---

### ç»™çˆ¸å¦ˆçš„3ä¸ªé£Ÿè°±ï¼ˆè€æäº²æµ‹ï¼‰

#### é£Ÿè°±1ï¼šç™½èåœç‚–ç¾Šè‚‰ï¼ˆä¸ä¸Šç«ç‰ˆï¼‰

**é€‚åˆ**ï¼šé˜³è™šæ€•å†·ã€æ‰‹è„šå†°å‡‰çš„è€äºº

**ææ–™**ï¼š
- ç¾Šè‚‰500gï¼ˆç¾Šè…¿è‚‰æœ€å¥½ï¼‰
- ç™½èåœ1æ ¹ï¼ˆå…³é”®ï¼ï¼‰
- ç”Ÿå§œ3ç‰‡
- æ¸æä¸€å°æŠŠ

**åšæ³•**ï¼š
1. ç¾Šè‚‰åˆ‡å—ï¼Œç„¯æ°´å»è¡€æ²«
2. ç™½èåœåˆ‡å—ï¼ˆçš®åˆ«å‰Šï¼çš®æ˜¯æ¸…çƒ­çš„ï¼‰
3. ç‚–ç…®1.5å°æ—¶
4. æœ€å10åˆ†é’Ÿæ”¾æ¸æ

**ä¸ºä»€ä¹ˆè¿™æ ·åƒä¸ä¸Šç«ï¼Ÿ**
- èåœæ¸…çƒ­ï¼Œä¸­å’Œç¾Šè‚‰çš„çƒ­æ€§
- æ¸ææ»‹é˜´ï¼Œå¹³è¡¡ç¾Šè‚‰çš„æ¸©ç‡¥

**è€æçš„ç»éªŒ**ï¼š
æˆ‘è¿™æ ·ç‚–ç»™æˆ‘çˆ¸åƒï¼Œè¿åƒ3æ¬¡ï¼Œä»–è¯´ï¼š"èº«ä¸Šæš–å’Œï¼Œä¸ä¸Šç«ï¼Œè¿™ä¸ªå¯¹ã€‚"

---

#### é£Ÿè°±2ï¼šå±±è¯è²å­é¸¡æ±¤

**é€‚åˆ**ï¼šè„¾èƒƒå¼±ã€å®¹æ˜“ä¸Šç«çš„è€äºº

**ææ–™**ï¼š
- é¸¡è‚‰500gï¼ˆæ¯é¸¡æ›´å¥½ï¼‰
- å±±è¯1æ®µ
- è²å­30é¢—ï¼ˆå»å¿ƒï¼‰
- çº¢æ£5é¢—
- ç”Ÿå§œ2ç‰‡

**åšæ³•**ï¼š
1. é¸¡è‚‰ç„¯æ°´
2. å±±è¯å»çš®åˆ‡å—
3. æ‰€æœ‰ææ–™ä¸€èµ·ç‚–2å°æ—¶
4. å°‘è®¸ç›è°ƒå‘³

**åŠŸæ•ˆ**ï¼š
- é¸¡è‚‰æ¸©è¡¥ï¼ˆæ¯”ç¾Šè‚‰å¹³å’Œï¼‰
- å±±è¯å¥è„¾
- è²å­å…»å¿ƒå®‰ç¥
- çº¢æ£è¡¥æ°”è¡€

**è¿™ä¸ªæ±¤ï¼Œæˆ‘åœ¨åŒ»é™¢æŠ¤å·¥çš„æ—¶å€™ï¼Œç»å¸¸ç»™è€äººç‚–ã€‚å–å®Œéƒ½è¯´ï¼š"èˆ’æœï¼Œç¡å¾—é¦™ã€‚"**

---

#### é£Ÿè°±3ï¼šç«‹æ˜¥å‰çš„"æ¸…è‚èŒ¶"

**æ—¶é—´**ï¼šå¤§å¯’æœ€å3å¤©

**é€‚åˆ**ï¼šå†¬å­£è¿›è¡¥åï¼Œéœ€è¦æ¸…ç†çš„è€äºº

**ææ–™**ï¼š
- èŠèŠ±5æœµï¼ˆæ¸…è‚æ˜ç›®ï¼‰
- æ¸æä¸€å°æŠŠï¼ˆè¡¥è‚¾ï¼‰
- å±±æ¥‚2ç‰‡ï¼ˆæ¶ˆé£Ÿï¼‰
- å†³æ˜å­10gï¼ˆæ¶¦è‚ ï¼‰

**åšæ³•**ï¼š
- å¼€æ°´å†²æ³¡
- ç„–10åˆ†é’Ÿ
- ä»£èŒ¶å–

**åŠŸæ•ˆ**ï¼š
- æ¸…ç†è‚ç«
- æ¶ˆé™¤è¿›è¡¥çš„"å­˜è´§"
- æ¶¦è‚ é€šä¾¿

**æˆ‘å¦ˆå–å®Œ3å¤©ï¼Œè¯´ï¼š"çœ¼ç›äº®äº†ï¼Œå¤§ä¾¿é€šç•…äº†ï¼Œå£ä¹Ÿä¸è‹¦äº†ã€‚"**

---

### ç»™å­å¥³çš„3ä¸ªæé†’

#### 1. æ—©ä¸Šåˆ«è®©çˆ¸å¦ˆç©ºè…¹å–å¤§è¡¥æ±¤

æˆ‘è§è¿‡è€äººæ—©ä¸Šç©ºè…¹å–äººå‚æ±¤ï¼Œç»“æœå¿ƒæ…Œã€å‡ºæ±—ã€è¡€å‹é£™å‡ã€‚

**è€äººæ—©é¤åƒä»€ä¹ˆï¼Ÿ**
- å°ç±³ç²¥ã€å…«å®ç²¥ï¼ˆå…»èƒƒï¼‰
- é¦’å¤´ã€é¸¡è›‹ï¼ˆå¥½æ¶ˆåŒ–ï¼‰
- ç‰›å¥¶ã€è±†æµ†ï¼ˆè¡¥è›‹ç™½ï¼‰

**å¤§è¡¥æ±¤ä»€ä¹ˆæ—¶å€™å–ï¼Ÿ**
- ä¸­åˆæˆ–æ™šä¸Š
- é¥­ååŠå°æ—¶
- ä¸€æ¬¡ä¸€å°ç¢—

---

#### 2. æ„Ÿå†’äº†åˆ«è¿›è¡¥

æœ‰äº›è€äººæ„Ÿå†’äº†è¿˜å–ç¾Šè‚‰æ±¤"å‘æ±—"ï¼Œè¿™æ˜¯é”™çš„ï¼

**æ„Ÿå†’æœŸé—´**ï¼š
- æ¸…æ·¡é¥®é£Ÿï¼ˆç²¥ã€é¢æ¡ï¼‰
- å¤šå–æ¸©æ°´
- å¤šä¼‘æ¯
- å¥½äº†å†è¡¥

**å‘Šè¯‰çˆ¸å¦ˆï¼š"æ„Ÿå†’æ˜¯èº«ä½“åœ¨æ‰“ä»—ï¼Œå…ˆåˆ«ç»™èƒƒå¢åŠ è´Ÿæ‹…ã€‚"**

---

#### 3. æœ‰æ…¢æ€§ç—…è¦å’¨è¯¢åŒ»ç”Ÿ

- **ç³–å°¿ç—…**ï¼šçº¢æ£ã€æ¸æå°‘åƒï¼ˆå«ç³–ï¼‰
- **é«˜è¡€å‹**ï¼šäººå‚ã€é¹¿èŒ¸æ…ç”¨ï¼ˆå‡å‹ï¼‰
- **ç—›é£**ï¼šç¾Šè‚‰ã€æµ“æ±¤å°‘å–ï¼ˆé«˜å˜Œå‘¤ï¼‰

**æœ€å¥½çš„å­é¡ºï¼Œä¸æ˜¯ä¹±ä¹°ï¼Œè€Œæ˜¯é—®æ¸…æ¥šã€å¼„æ˜ç™½ã€‚**

---

### æœ€åçš„è¯ï¼šç»™å­å¥³ï¼Œä¹Ÿç»™çˆ¶æ¯

**ç»™å­å¥³**ï¼š
æœ€å¥½çš„å­é¡ºï¼Œä¸æ˜¯ä¹°æœ€è´µçš„ï¼Œè€Œæ˜¯ç»™æœ€åˆé€‚çš„ã€‚
ä¸€ç¢—æ±¤ã€ä¸€é¡¿é¥­ã€ä¸€ä»½å…³å¿ƒï¼Œæ¯”ä»€ä¹ˆè¡¥å“éƒ½å¼ºã€‚

**ç»™çˆ¶æ¯**ï¼š
å­å¥³ç»™çš„ï¼Œéƒ½æ˜¯å¿ƒæ„ã€‚
åƒå¯¹äº†ï¼Œèº«ä½“å¥½ï¼Œå°±æ˜¯ç»™ä»–ä»¬æœ€å¤§çš„å®‰æ…°ã€‚

---

**å¤§å¯’äº†ï¼Œç»™çˆ¸å¦ˆç‚–ç¢—æ±¤å§ã€‚**
**æˆ–è€…ï¼ŒæŠŠè¿™ç¯‡æ–‡ç« è½¬ç»™ä»–ä»¬ã€‚**
**è®©ä»–ä»¬çŸ¥é“ï¼šä½ æ‡‚ä»–ä»¬çš„èº«ä½“ï¼Œä½ çˆ±ä»–ä»¬ã€‚**

---

**ã€è€æçš„æ±¤ï¼Œæš–èº«ä¹Ÿæš–å¿ƒã€‘**

**å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œè½¬å‘ç»™çˆ¸å¦ˆã€è½¬å‘ç»™æœ‹å‹ã€‚**
**è®©æ›´å¤šè€äººï¼Œåƒå¯¹ã€åƒå¥½ã€å¥åº·è¿‡å†¬ã€‚**

**æœ‰é—®é¢˜è¯„è®ºåŒºè¯´ï¼Œè€æçœ‹åˆ°äº†ï¼Œä¸€å®šå›ã€‚**""",
            "word_count": 2800,
            "sources": [
                "ã€Šéšæ¯å±…é¥®é£Ÿè°±ã€‹- æ¸…ä»£ ç‹å­Ÿè‹±",
                "ã€ŠåŒ»å­¦è¡·ä¸­å‚è¥¿å½•ã€‹- å¼ é”¡çº¯",
                "è€ä¸­åŒ»ç»éªŒæ€»ç»“"
            ],
            "old_li_voice": [
                "æˆ‘é‚£ä¼šå„¿åœ¨å·¥å‚ï¼Œè€å¸ˆå‚…æ€»è¯´ï¼š'ä¸‰ä¹è¡¥ä¸€å†¬ï¼Œæ¥å¹´æ— ç—…ç—›ã€‚'",
                "ç§€èŠ³ï¼ˆæˆ‘è€ä¼´ï¼‰æ€»å” å¨ï¼š'èåœæ±¤ï¼Œå–ä¸‰å¤©ï¼Œè‚šå­èˆ’æœã€‚'",
                "æˆ‘åœ¨åŒ»é™¢å½“æŠ¤å·¥é‚£å‡ å¹´ï¼Œè§è¿‡å¤ªå¤šè€äºº..."
            ],
            "keywords": viral_analysis.get("keywords", {}),
            "_metadata": {
                "agent_id": self.agent_id,
                "timestamp": datetime.now().isoformat(),
                "note": "æ¨¡æ‹Ÿæ•°æ®"
            }
        }


# ============================================================================
# Agent 5: Chief Reviewer - è´¨é‡å®¡æ ¸
# ============================================================================

class Agent5ChiefReviewer:
    """Agent 5: è´¨é‡å®¡æ ¸å‘˜"""

    def __init__(self, llm_caller=None):
        self.agent_id = "Agent_5_ChiefReviewer"
        self.agent_name = "è´¨é‡å®¡æ ¸å‘˜"
        self.llm_caller = llm_caller

    def review_and_route(
        self,
        draft: Dict,
        mode: str = "standard"
    ) -> Dict:
        """
        å®¡æ ¸æ–‡ç« å¹¶åšå‡ºè·¯ç”±å†³ç­–

        Args:
            draft: æ–‡ç« è‰ç¨¿
            mode: æ¨¡å¼ï¼ˆstandard/fastï¼‰

        Returns:
            å®¡æ ¸æŠ¥å‘Šå’Œè·¯ç”±å†³ç­–
        """
        if self.llm_caller is None:
            return self._get_mock_review(draft)

        return self._get_mock_review(draft)

    def _get_mock_review(self, draft: Dict) -> Dict:
        """è·å–æ¨¡æ‹Ÿçš„å®¡æ ¸ç»“æœ"""
        return {
            "routing_decision": "APPROVED",  # APPROVED, REVISE_CONTENT, REVISE_STRUCTURE, ADJUST_TONE, ESCALATE
            "reason": "è´¨é‡ç¬¦åˆæ ‡å‡†",
            "quality_score": 88,
            "tone_compliance": 92,
            "old_li_persona_compliance": 94,
            "checks": {
                "factual_accuracy": {
                    "status": "PASS",
                    "score": 90,
                    "notes": "ä¸­åŒ»ç†è®ºå‡†ç¡®ï¼Œæ— è™šå‡ä¿¡æ¯"
                },
                "practicality": {
                    "status": "PASS",
                    "score": 95,
                    "notes": "é£Ÿè°±å…·ä½“å¯æ“ä½œ"
                },
                "tone_consistency": {
                    "status": "PASS",
                    "score": 92,
                    "notes": "è€æäººè®¾ç¬¦åˆåº¦é«˜"
                },
                "emotional_resonance": {
                    "status": "PASS",
                    "score": 90,
                    "notes": "æƒ…æ„Ÿå…±é¸£å¼º"
                },
                "compliance": {
                    "status": "PASS",
                    "score": 100,
                    "notes": "æ— è¿è§„å†…å®¹"
                }
            },
            "issues": [],
            "suggestions": [],
            "strengths": [
                "æ—¶æ•ˆæ€§å¼ºï¼ˆå¤§å¯’æ—¶èŠ‚ï¼‰",
                "è€æäººè®¾çœŸå®",
                "é£Ÿè°±å…·ä½“å¯æ“ä½œ",
                "å­å¥³é™ªä¼´å¿ƒç†çªå‡º"
            ],
            "next_steps": "ç»§ç»­ Agent 6ï¼ˆçˆ†æ¬¾é¢„æµ‹ï¼‰",
            "_metadata": {
                "agent_id": self.agent_id,
                "timestamp": datetime.now().isoformat(),
                "note": "æ¨¡æ‹Ÿæ•°æ®"
            }
        }


# ============================================================================
# Agent 6: Virality Forecaster - çˆ†æ¬¾é¢„æµ‹
# ============================================================================

class Agent6ViralityForecaster:
    """Agent 6: çˆ†æ¬¾é¢„æµ‹å¸ˆ"""

    def __init__(self, llm_caller=None):
        self.agent_id = "Agent_6_ViralityForecaster"
        self.agent_name = "çˆ†æ¬¾é¢„æµ‹å¸ˆ"
        self.llm_caller = llm_caller

    def predict_virality(
        self,
        draft: Dict,
        review_report: Dict
    ) -> Dict:
        """
        é¢„æµ‹æ–‡ç« çš„çˆ†æ¬¾æ½œåŠ›

        Args:
            draft: æ–‡ç« è‰ç¨¿
            review_report: Agent 5 çš„å®¡æ ¸æŠ¥å‘Š

        Returns:
            çˆ†æ¬¾é¢„æµ‹æŠ¥å‘Š
        """
        if self.llm_caller is None:
            return self._get_mock_prediction()

        return self._get_mock_prediction()

    def _get_mock_prediction(self) -> Dict:
        """è·å–æ¨¡æ‹Ÿçš„é¢„æµ‹ç»“æœ"""
        return {
            "virality_assessment": {
                "emotion": {
                    "score": 9,
                    "analysis": "æ¸©æš–+æ‹…å¿ƒ+å¸Œæœ›ï¼Œæƒ…æ„Ÿå±‚æ¬¡ä¸°å¯Œ",
                    "triggers": ["ç»™çˆ¸å¦ˆçš„æ¸©æš–", "æ‹…å¿ƒçˆ¶æ¯å¥åº·", "å¸Œæœ›æ‰¾åˆ°å¥½æ–¹æ³•"]
                },
                "practicality": {
                    "score": 9,
                    "analysis": "3ä¸ªé£Ÿè°±å…·ä½“å¯æ“ä½œ",
                    "value": "é«˜å®ç”¨ä»·å€¼ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨"
                },
                "social_currency": {
                    "score": 9,
                    "analysis": "è½¬å‘ç»™çˆ¶æ¯=è¡¨è¾¾å…³å¿ƒ",
                    "motivation": "å­å¥³è½¬å‘ç»™çˆ¶æ¯ï¼Œæœ‹å‹è½¬å‘ç»™æœ‹å‹"
                },
                "novelty": {
                    "score": 7,
                    "analysis": "å¤§å¯’è¿›è¡¥è¯é¢˜è¾ƒå¸¸è§",
                    "differentiation": "è€æç‹¬ç‰¹è§†è§’ï¼ˆå·¥å‚+æŠ¤å·¥ç»å†ï¼‰"
                },
                "timeliness": {
                    "score": 9,
                    "analysis": "å¤§å¯’æ—¶èŠ‚ï¼Œæ—¶æ•ˆæ€§å¼º",
                    "urgency": "ç°åœ¨ä¸çœ‹ï¼Œè¦ç­‰ä¸€å¹´"
                }
            },
            "overall_score": 43,
            "max_score": 50,
            "prediction": "HIGH_POTENTIAL",  # HIGH_POTENTIAL, MEDIUM, LOW
            "confidence": 0.85,
            "optimization_suggestions": [
                "æ ‡é¢˜å¯ä»¥æ›´å…·ä½“ï¼ˆå¦‚ï¼šå¤§å¯’åƒé”™ï¼Œä¸Šç«æµé¼»è¡€ï¼‰",
                "å¢åŠ æ•°æ®å¯¹æ¯”ï¼ˆå¦‚ï¼š90%çš„äººéƒ½è¿›è¡¥é”™äº†ï¼‰",
                "å¼ºåŒ–'å­å¥³è½¬å‘'çš„åŠ¨æœº"
            ],
            "similar_articles_performance": {
                "avg_views": 50000,
                "avg_likes": 1500,
                "avg_shares": 800,
                "top_performing": "100000+ é˜…è¯»"
            },
            "_metadata": {
                "agent_id": self.agent_id,
                "timestamp": datetime.now().isoformat(),
                "note": "æ¨¡æ‹Ÿæ•°æ®"
            }
        }


# ============================================================================
# Agent 7: Headline King - æ ‡é¢˜ç”Ÿæˆ
# ============================================================================

class Agent7HeadlineKing:
    """Agent 7: æ ‡é¢˜ä¹‹ç‹"""

    def __init__(self, llm_caller=None):
        self.agent_id = "Agent_7_HeadlineKing"
        self.agent_name = "æ ‡é¢˜ä¹‹ç‹"
        self.llm_caller = llm_caller

    def generate_headlines(
        self,
        draft: Dict,
        target_audience: Optional[Dict] = None,
        mode: str = "standard"
    ) -> Dict:
        """
        ç”Ÿæˆæ–‡ç« æ ‡é¢˜

        Args:
            draft: æ–‡ç« è‰ç¨¿
            target_audience: ç›®æ ‡å—ä¼—
            mode: æ¨¡å¼

        Returns:
            æ ‡é¢˜ç”Ÿæˆç»“æœ
        """
        if self.llm_caller is None:
            return self._get_mock_headlines()

        return self._get_mock_headlines()

    def _get_mock_headlines(self) -> Dict:
        """è·å–æ¨¡æ‹Ÿçš„æ ‡é¢˜"""
        return {
            "generated": [
                "å¤§å¯’äº†ï¼Œç»™çˆ¸å¦ˆç‚–è¿™ç¢—æ±¤ï¼Œæ¯”ä¹°è¡¥å“å¼ºç™¾å€ï¼ˆé™„3ä¸ªé£Ÿè°±ï¼‰",
                "å¤§å¯’åƒé”™ï¼Œä¸Šç«æµé¼»è¡€ï¼è€ä¸­åŒ»æ•™æˆ‘3æ‹›ï¼Œä¿äº†ä¸€å†¬çš„å¿ƒè„",
                "è€ä¸­åŒ»è¯´ï¼šå¤§å¯’è¿›è¡¥æœ‰ä¸ª'ä¸‰å­—ç»'ï¼Œ90%çš„äººéƒ½åƒé”™äº†",
                "ç»™çˆ¸å¦ˆä¹°2000å—è¡¥å“ï¼Œä¸å¦‚ç‚–è¿™ç¢—æ±¤ï¼è€ä¸­åŒ»æ•™æˆ‘3æ‹›",
                "æˆ‘é‚£ä¼šå„¿åœ¨å·¥å‚å½“æŠ¤å·¥ï¼Œè§è¿‡å¤ªå¤šè€äººï¼šå¤§å¯’è¿›è¡¥ï¼Œæ¸©é€šæ—¶æ˜¯å…³é”®",
                "å¤§å¯’åˆ°ç«‹æ˜¥ï¼Œæ€ä¹ˆåƒæ‰ä¸ä¸Šç«ï¼Ÿè€æçš„3ä¸ªé¥®é£ŸåŸåˆ™",
                "90%çš„äººéƒ½ä¸çŸ¥é“ï¼å¤§å¯’è¿›è¡¥ï¼Œèåœæ¯”ç¾Šè‚‰é‡è¦",
                "è€ä¸­åŒ»çš„3ä¸ªè¿›è¡¥æ–¹ï¼Œæ¯”äººå‚è¿˜ç®¡ç”¨ï¼Œçˆ¸å¦ˆéƒ½è¯´å¥½",
                "å¤§å¯’äº†ï¼Œåˆ«çè¡¥ï¼è€ä¸­åŒ»æ•™æˆ‘ï¼šæ¸©ã€é€šã€æ—¶ä¸‰ä¸ªå­—",
                "è¿åƒ3å¤©ç¾Šè‚‰ä¸Šç«æµé¼»è¡€ï¼Œè€ä¸­åŒ»è¯´ï¼šä½ åƒé”™äº†æ—¶æœº",
                "ç»™çˆ¸å¦ˆçš„3ä¸ªé£Ÿè°±ï¼Œæ¯”2000å—è¡¥å“è¿˜å¼ºï¼Œå¤§å¯’å¿…å¤‡",
                "å¤§å¯’è¿›è¡¥çš„è¯¯åŒºï¼Œè€ä¸­åŒ»å‘Šè¯‰æˆ‘ï¼šè¿™æ—¶å€™åƒèåœ"
            ],
            "selected": [
                {
                    "title": "å¤§å¯’äº†ï¼Œç»™çˆ¸å¦ˆç‚–è¿™ç¢—æ±¤ï¼Œæ¯”ä¹°è¡¥å“å¼ºç™¾å€ï¼ˆé™„3ä¸ªé£Ÿè°±ï¼‰",
                    "ctr_prediction": 12.5,
                    "reason": "æƒ…æ„Ÿ+å®ç”¨+å…·ä½“ï¼Œå‡»ä¸­å­å¥³å¿ƒç†",
                    "style": "æƒ…æ„Ÿä»·å€¼å‹"
                },
                {
                    "title": "å¤§å¯’åƒé”™ï¼Œä¸Šç«æµé¼»è¡€ï¼è€ä¸­åŒ»æ•™æˆ‘3æ‹›ï¼Œä¿äº†ä¸€å†¬çš„å¿ƒè„",
                    "ctr_prediction": 11.8,
                    "reason": "ææƒ§+æƒå¨+è§£å†³æ–¹æ¡ˆï¼Œç´§è¿«æ„Ÿå¼º",
                    "style": "ææƒ§æƒå¨å‹"
                },
                {
                    "title": "ç»™çˆ¸å¦ˆä¹°2000å—è¡¥å“ï¼Œä¸å¦‚ç‚–è¿™ç¢—æ±¤ï¼è€ä¸­åŒ»æ•™æˆ‘3æ‹›",
                    "ctr_prediction": 11.2,
                    "reason": "åå·®+å®ç”¨+æƒå¨ï¼Œåˆ¶é€ è®¤çŸ¥å†²çª",
                    "style": "åå·®å¯¹æ¯”å‹"
                }
            ],
            "total_generated": 12,
            "style_distribution": {
                "æƒ…æ„Ÿä»·å€¼å‹": 4,
                "ææƒ§æƒå¨å‹": 3,
                "åå·®å¯¹æ¯”å‹": 3,
                "æ•°å­—æ¸…å•å‹": 2
            },
            "optimization_suggestions": [
                "å¯ä»¥åŠ å…¥å…·ä½“æ•°å­—ï¼ˆå¦‚ï¼š3ä¸ªé£Ÿè°±ï¼Œåƒ3æ¬¡ï¼‰",
                "å¯ä»¥å¢åŠ ç´§è¿«æ„Ÿï¼ˆå¦‚ï¼šç°åœ¨ä¸çœ‹ï¼Œå†ç­‰ä¸€å¹´ï¼‰",
                "å¯ä»¥çªå‡ºè€æçš„ç‹¬ç‰¹æ€§ï¼ˆæŠ¤å·¥8å¹´ç»éªŒï¼‰"
            ],
            "_metadata": {
                "agent_id": self.agent_id,
                "timestamp": datetime.now().isoformat(),
                "note": "æ¨¡æ‹Ÿæ•°æ®"
            }
        }


# ============================================================================
# ä¾¿æ·å‡½æ•°
# ============================================================================

def create_agent_4(llm_caller=None) -> Agent4ContentArchitect:
    """åˆ›å»º Agent 4"""
    return Agent4ContentArchitect(llm_caller=llm_caller)


def create_agent_5(llm_caller=None) -> Agent5ChiefReviewer:
    """åˆ›å»º Agent 5"""
    return Agent5ChiefReviewer(llm_caller=llm_caller)


def create_agent_6(llm_caller=None) -> Agent6ViralityForecaster:
    """åˆ›å»º Agent 6"""
    return Agent6ViralityForecaster(llm_caller=llm_caller)


def create_agent_7(llm_caller=None) -> Agent7HeadlineKing:
    """åˆ›å»º Agent 7"""
    return Agent7HeadlineKing(llm_caller=llm_caller)


# ============================================================================
# ä¸»ç¨‹åºï¼ˆæµ‹è¯•ï¼‰
# ============================================================================

def main():
    """æµ‹è¯•æ‰€æœ‰ Agent"""
    print("=" * 70)
    print("Agent 4-7 æµ‹è¯•")
    print("=" * 70)

    # æ¨¡æ‹Ÿè¾“å…¥æ•°æ®
    topic = "å¤§å¯’è¿›è¡¥æ€ä¹ˆåƒæ‰ä¸ä¸Šç«"
    viral_analysis = {"topic": topic}
    outline = {"topic": topic}

    # Agent 4
    print("\nğŸ“ Agent 4: å†…å®¹å†™ä½œ")
    agent4 = Agent4ContentArchitect()
    draft = agent4.write_article(topic, outline, viral_analysis)
    print(f"âœ… ç”Ÿæˆæ–‡ç« : {draft['word_count']} å­—")

    # Agent 5
    print("\nğŸ” Agent 5: è´¨é‡å®¡æ ¸")
    agent5 = Agent5ChiefReviewer()
    review = agent5.review_and_route(draft)
    print(f"âœ… å®¡æ ¸ç»“æœ: {review['routing_decision']}")
    print(f"   è´¨é‡åˆ†æ•°: {review['quality_score']}/100")

    # Agent 6
    print("\nğŸ“ˆ Agent 6: çˆ†æ¬¾é¢„æµ‹")
    agent6 = Agent6ViralityForecaster()
    prediction = agent6.predict_virality(draft, review)
    print(f"âœ… çˆ†æ¬¾åˆ†æ•°: {prediction['overall_score']}/50")
    print(f"   é¢„æµ‹: {prediction['prediction']}")

    # Agent 7
    print("\nğŸ“° Agent 7: æ ‡é¢˜ç”Ÿæˆ")
    agent7 = Agent7HeadlineKing()
    headlines = agent7.generate_headlines(draft)
    print(f"âœ… ç”Ÿæˆæ ‡é¢˜: {headlines['total_generated']} ä¸ª")
    print(f"   TOP 1: {headlines['selected'][0]['title']}")
    print(f"   é¢„æµ‹CTR: {headlines['selected'][0]['ctr_prediction']}%")

    print("\n" + "=" * 70)
    print("âœ… æ‰€æœ‰ Agent æµ‹è¯•å®Œæˆ")
    print("=" * 70)


if __name__ == "__main__":
    main()
